function Init(a){g_StatData=a,g_rgRadiantKillMatrix=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],radiantAssistMatrix=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],direKillMatrix=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],direAssistMatrix=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],radiantKillShares=[[],[],[],[],[],[]],radiantTimedKills=[],radiantStackedKills=[],direKillShares=[[],[],[],[],[],[]],direTimedKills=[],direStackedKills=[],radiantDamageDone=[0,0,0,0,0],direDamageDone=[0,0,0,0,0],g_rgPersonaArray=jQuery.map(g_StatData.hero_lookup,function(a,e){return[[a.persona]]}),g_rgPersonaArray.push(["Other"]),g_rgHeroArray=jQuery.map(g_StatData.hero_lookup,function(a,e){return[[a.hero_name]]}),g_rgHeroIDArray=jQuery.map(g_StatData.hero_lookup,function(a,e){return[[a.hero_id]]}),g_DireBalance=jQuery.map(g_StatData.dire_stats,function(a,e){return[[parseInt(a.balance_kill_value),parseInt(a.balance_tower_value),parseInt(a.balance_barracks_value),parseInt(a.balance_gold_value),parseInt(a.balance_xp_value)]]}),g_RadiantBalance=jQuery.map(g_StatData.radiant_stats,function(a,e){return[[parseInt(a.balance_kill_value),parseInt(a.balance_tower_value),parseInt(a.balance_barracks_value),parseInt(a.balance_gold_value),parseInt(a.balance_xp_value)]]}),numStatMinutes=g_DireBalance.length,direKillBarWidth=ParseKillData(g_StatData.dire_kills,direTimedKills,direKillShares,direKillMatrix,direAssistMatrix),radiantKillBarWidth=ParseKillData(g_StatData.radiant_kills,radiantTimedKills,radiantKillShares,g_rgRadiantKillMatrix,radiantAssistMatrix),TallyDamageDone(direKillShares,direDamageDone),TallyDamageDone(radiantKillShares,radiantDamageDone),direDamageDone=NormalizeArray(direDamageDone),radiantDamageDone=NormalizeArray(radiantDamageDone),StackTimedKills(g_StatData.radiant_kills,radiantStackedKills),StackTimedKills(g_StatData.dire_kills,direStackedKills),radiantKillParticipation=[0,0,0,0,0],direKillParticipation=[0,0,0,0,0],CalculateKillParticipation(radiantKillParticipation,g_rgRadiantKillMatrix,radiantAssistMatrix),CalculateKillParticipation(direKillParticipation,direKillMatrix,direAssistMatrix),direTowerKills=jQuery.map(g_StatData.dire_stats,function(a,e){return[[e,parseInt(a.tower_kills)]]}),radiantTowerKills=jQuery.map(g_StatData.radiant_stats,function(a,e){return[[e,parseInt(a.tower_kills)]]}),totalTowerKills=[];for(var e=0;e<direTowerKills.length;e++)totalTowerKills.push([e+1,direTowerKills[e][1]+radiantTowerKills[e][1]]);for(direLanePerformance=[[],[],[],[],[],[]],radLanePerformance=[[],[],[],[],[],[]],ReadLanePerformance(g_StatData.dire_stats,direLanePerformance),ReadLanePerformance(g_StatData.radiant_stats,radLanePerformance),direHeroPositions=[],direHeroPositionsDetailed=[],direHeroPositionsSimple=[],direTeamPositionsSimple=[],direTeamPositionsDetailed=[],radiantHeroPositions=[],radiantHeroPositionsDetailed=[],radiantHeroPositionsSimple=[],radiantTeamPositionsSimple=[],radiantTeamPositionsDetailed=[],ReadHeroPositions(g_StatData.dire_stats,direHeroPositions,direHeroPositionsDetailed,direHeroPositionsSimple,direTeamPositionsSimple,direTeamPositionsDetailed,!0),ReadHeroPositions(g_StatData.radiant_stats,radiantHeroPositions,radiantHeroPositionsDetailed,radiantHeroPositionsSimple,radiantTeamPositionsSimple,radiantTeamPositionsDetailed,!1),e=0;5>e;e++)NewNormalizeArray(direHeroPositionsSimple[e]),NewNormalizeArray(radiantHeroPositionsSimple[e]);for(e=0;5>e;e++){for(position=0;position<15;position++)IncrementalToCumulative(direHeroPositionsDetailed[e][position]),IncrementalToCumulative(radiantHeroPositionsDetailed[e][position]);NewNormalizeArray(direHeroPositionsDetailed[e]),NewNormalizeArray(radiantHeroPositionsDetailed[e])}for(position=0;position<15;position++)IncrementalToCumulative(direTeamPositionsDetailed[0][position]),IncrementalToCumulative(radiantTeamPositionsDetailed[0][position]);for(NewNormalizeArray(direTeamPositionsSimple[0]),NewNormalizeArray(radiantTeamPositionsSimple[0]),NewNormalizeArray(direTeamPositionsDetailed[0]),NewNormalizeArray(radiantTeamPositionsDetailed[0]),PrependValues(direHeroPositions,1),PrependValues(radiantHeroPositions,0),direHeroPositions=CreateStdevSeries(direHeroPositions),radiantHeroPositions=CreateStdevSeries(radiantHeroPositions),g_rgDireParsedHeroPositions=[],g_rgRadiantParsedHeroPositions=[],g_rgParsedHeroPositions=[],e=0;5>e;e++)g_rgDireParsedHeroPositions[e]=jQuery.map(g_StatData.dire_stats,function(a,i){return[parseFloat(a.player_stats[e+1].position_info.average_position)]}),g_rgRadiantParsedHeroPositions[e]=jQuery.map(g_StatData.radiant_stats,function(a,i){return[parseFloat(a.player_stats[e+1].position_info.average_position)]});for(PrependValues(g_rgDireParsedHeroPositions,0),PrependValues(g_rgRadiantParsedHeroPositions,0),g_rgDireParsedHeroPositions=ParseHeroPosition(g_rgDireParsedHeroPositions,5),g_rgRadiantParsedHeroPositions=ParseHeroPosition(g_rgRadiantParsedHeroPositions,0),g_rgParsedHeroPositions.teambase=g_rgRadiantParsedHeroPositions.teambase.concat(g_rgDireParsedHeroPositions.teambase),g_rgParsedHeroPositions.teamside=g_rgRadiantParsedHeroPositions.teamside.concat(g_rgDireParsedHeroPositions.teamside),g_rgParsedHeroPositions.mid=g_rgRadiantParsedHeroPositions.mid.concat(g_rgDireParsedHeroPositions.mid),g_rgParsedHeroPositions.enemyside=g_rgRadiantParsedHeroPositions.enemyside.concat(g_rgDireParsedHeroPositions.enemyside),g_rgParsedHeroPositions.enemybase=g_rgRadiantParsedHeroPositions.enemybase.concat(g_rgDireParsedHeroPositions.enemybase),direAvailableLaneGold=jQuery.map(g_StatData.dire_stats,function(a,e){return[[e,parseInt(a.available_lane_creep_gold)]]}),radiantAvailableLaneGold=jQuery.map(g_StatData.radiant_stats,function(a,e){return[[e,parseInt(a.available_lane_creep_gold)]]}),direCreepGold=jQuery.map(g_StatData.dire_stats,function(a,e){var i=0;for(var r in a.player_stats)i+=parseInt(a.player_stats[r].harvested_creep_gold);return[[parseInt(e)-.5,i]]}),radiantCreepGold=jQuery.map(g_StatData.radiant_stats,function(a,e){var i=0;for(var r in a.player_stats)i+=parseInt(a.player_stats[r].harvested_creep_gold);return[[parseInt(e)-.5,i]]}),direOverallFarmEfficiency=makeRelative(direCreepGold,direAvailableLaneGold),radiantOverallFarmEfficiency=MakeRelative(radiantCreepGold,radiantAvailableLaneGold),direAvailableLaneGold=additiveToIncremental(direAvailableLaneGold),radiantAvailableLaneGold=additiveToIncremental(radiantAvailableLaneGold),direCreepGold=additiveToIncremental(direCreepGold),radiantCreepGold=additiveToIncremental(radiantCreepGold),direFarmEfficiency=MakeRelative(direCreepGold,direAvailableLaneGold),radiantFarmEfficiency=MakeRelative(radiantCreepGold,radiantAvailableLaneGold),radiantCreepFarm=[],direCreepFarm=[],opposedCreepFarm=[],e=0;5>e;e++)radiantCreepFarm[e]=jQuery.map(g_StatData.radiant_stats,function(a,i){var r=0;return r=a.player_stats[e+1].harvested_creep_gold,[[i,parseInt(r)]]}),direCreepFarm[e]=jQuery.map(g_StatData.dire_stats,function(a,i){var r=0;return r=a.player_stats[e+1].harvested_creep_gold,[[i,parseInt(r)]]}),opposedCreepFarm[e]=jQuery.map(g_StatData.radiant_stats,function(a,i){var r=0;return r=a.player_stats[e+1].harvested_creep_gold,[[i,parseInt(r)]]}),opposedCreepFarm[e+5]=jQuery.map(g_StatData.dire_stats,function(a,i){var r=0;return r=a.player_stats[e+1].harvested_creep_gold,[[i,parseInt(r)]]});radiantCreepFarm=NormalizeData(radiantCreepFarm),direCreepFarm=NormalizeData(direCreepFarm),opposedCreepFarm=NormalizeData(opposedCreepFarm)}function GenerateTeamSummary(){var a=$("#TeamSummary"),e="<table style='width:100%'>";e+="<tr><th>Player</th><th>Hero</th><th></th><th>Farm Pct</th><th>Fight Participation</th><th>Damage Pct</th></tr>";for(var i=0;5>i;i++){var r=radiantCreepFarm[i][radiantCreepFarm[i].length-1][1].toFixed(1),t=(100*radiantKillParticipation[i]).toFixed(1),o=(100*radiantDamageDone[i]).toFixed(1),n=g_strImageURL+"heroes/"+g_HeroData[g_rgHeroIDArray[i]].portait+"_eg.png";n="<img src="+n+">",e+="<tr><td>"+g_rgPersonaArray[i]+"</td><td>"+n+"</td><td>"+g_rgHeroArray[i]+"</td><td>"+r+"%</td><td>"+t+"%</td><td>"+o+"%</td></tr>"}e+="</table>",a.append(e),e="<br><table style='width:100%'>",e+="<tr><th>Player</th><th>Hero</th><th></th><th>Farm Pct</th><th>Fight Participation</th><th>Damage Pct</th></tr>";for(var i=0;5>i;i++){var r=direCreepFarm[i][direCreepFarm[i].length-1][1].toFixed(1),t=(100*direKillParticipation[i]).toFixed(1),o=(100*direDamageDone[i]).toFixed(1),n=g_strImageURL+"heroes/"+g_HeroData[g_rgHeroIDArray[i+5]].portait+"_eg.png";n="<img src="+n+">",e+="<tr><td>"+g_rgPersonaArray[i+5]+"</td><td>"+n+"</td><td>"+g_rgHeroArray[i+5]+"</td><td>"+r+"%</td><td>"+t+"%</td><td>"+o+"%</td></tr>"}e+="</table>",a.append(e)}function NormalizeData(a){for(timeIdx=0;timeIdx<a[0].length;timeIdx++){for(totalFarm=0,playerIdx=0;playerIdx<a.length;playerIdx++)totalFarm+=Math.max(.01,parseFloat(a[playerIdx][timeIdx][1]));for(playerIdx=0;playerIdx<a.length;playerIdx++)a[playerIdx][timeIdx][1]/=.010001*totalFarm}return a}function NormalizeArray(a){var e=a,r=0;for(i=0;i<e.length;i++)r+=e[i];if(r>0)for(i=0;i<e.length;i++)e[i]/=r;return e}function NewNormalizeArray(a){for(timeIdx=0;timeIdx<a[0].length;timeIdx++){var e=0;for(i=0;i<a.length;i++)0==i&&a[i][timeIdx][1]<1e4&&(a[i][timeIdx][1]=0),e+=a[i][timeIdx][1];if(e>0)for(i=0;i<a.length;i++)a[i][timeIdx][1]/=e}}function SimplifyHeroPositions(a){var e=[[],[],[],[],[],[],[],[],[]];for(timeIdx=0;timeIdx<a[0].length;timeIdx++)for(i=0;i<e.length;i++)e[i].push([timeIdx,0]);for(timeIdx=0;timeIdx<a[0].length;timeIdx++)for(i=0;i<a.length;i++)e[g_rgPositionTranslation[i]][timeIdx][1]+=a[i][timeIdx][1];return e}function IncrementalToCumulative(a){var e=a;for(timeIdx=1;timeIdx<a.length;timeIdx++)e[timeIdx][1]=a[timeIdx][1]+a[timeIdx-1][1];return e}function MakeRelative(a,e){var i=[];for(timeIdx=0;timeIdx<a.length;timeIdx++){var r=a[timeIdx][0];i.push(null==a[timeIdx][1]?[r,null]:e[timeIdx][1]>0?[r,100*a[timeIdx][1]/e[timeIdx][1]]:[r,0])}return i}function CreateStdevSeries(a){var e={high:[],mean:[],low:[]};for(timeIdx=0;timeIdx<a[0].length;timeIdx++){var i=0;for(playerIdx=0;playerIdx<a.length;playerIdx++)i+=a[playerIdx][timeIdx];var r=0;for(i/=a.length,playerIdx=0;playerIdx<a.length;playerIdx++)r+=Math.pow(a[playerIdx][timeIdx]-i,2);r=Math.sqrt(r),e.mean.push([timeIdx,i]),e.high.push([timeIdx,i+r]),e.low.push([timeIdx,i-r])}return e}function TallyDamageDone(a,e){for(killIdx=0;killIdx<a[0].length;killIdx++)for(playerIdx=0;playerIdx<a.length-1;playerIdx++)e[playerIdx]+=a[playerIdx][killIdx][1]}function CalculateKillParticipation(a,e,r){var t=0;for(i=0;i<e.length;i++)for(j=0;j<e[i].length;j++)t+=e[i][j];for(i=0;i<e.length;i++){var o=0,n=0;for(j=0;j<e[i].length;j++)o+=e[i][j],n+=r[i][j];a[i]=t>0?(o+n)/t:0}}function PrependValues(a,e){for(i=0;i<a.length;i++)a[i].splice(0,0,e)}function DuplicateFirstValue(a){if(0!=a[0].length)for(i=0;i<a.length;i++)a[i].splice(0,0,[0,a[i][0][1]])}function StackTimedKills(a,e){lastKillTime=-1,killsThisMinute=0;for(var i in a){var r=Math.floor(parseFloat(a[i].death_time)/60);r==lastKillTime?killsThisMinute++:(killsThisMinute=0,lastKillTime=r);var t=[r,killsThisMinute,parseInt(a[i].victim_id)];e.push(t)}}function ParseHeroPosition(a,e){var i={teambase:[],teamside:[],mid:[],enemyside:[],enemybase:[]};for(playerIdx=0;playerIdx<a.length;playerIdx++){var r=0,t=0,o=0,n=0,l=0;for(timeIdx=0;timeIdx<a[0].length;timeIdx++)a[playerIdx][timeIdx]<=.2?r++:a[playerIdx][timeIdx]>.2&&a[playerIdx][timeIdx]<=.4?t++:a[playerIdx][timeIdx]>.4&&a[playerIdx][timeIdx]<=.6?o++:a[playerIdx][timeIdx]>.6&&a[playerIdx][timeIdx]<=.8?n++:l++;r/=a[0].length,t/=a[0].length,o/=a[0].length,n/=a[0].length,l/=a[0].length,i.teambase.push([r,playerIdx+e]),i.teamside.push([t,playerIdx+e]),i.mid.push([o,playerIdx+e]),i.enemyside.push([n,playerIdx+e]),i.enemybase.push([l,playerIdx+e])}return i}function FormatTicks(a,e){return VUtils.AbbreviateNumber(a)}function FormatTickAsTime(a,e){return VUtils.FormatTimestamp(a)}function BIsSameTeam(a,e){return-1==a||-1==e||a>=5&&5>e||5>a&&e>=5?!1:!0}function PlayerToTeamIdx(a){return a>=5?a-5:a}function GetHeroImage(a){var e=new Image;return e.src=g_strImageURL+"heroes/"+g_HeroData[a].portait+"_icon.png",e}function ReadLanePerformance(a,e){for(locIdx=0;locIdx<e.length;locIdx++)e[locIdx]=jQuery.map(a,function(a,e){var i=[[0,0,0,0]];for(var r in a.lane_performance)parseInt(a.lane_performance[r].location_category)==locIdx&&(i[0][parseInt(a.lane_performance[r].stat_type)]+=parseInt(a.lane_performance[r].value));return i})}function ReadHeroPositions(a,e,i,r,t,o,n){for(idx=0;idx<5;idx++)e[idx]=jQuery.map(a,function(a,e){var i=parseFloat(a.player_stats[idx+1].position_info.average_position);return n&&(i=1-i),[i]});for(idx=0;idx<5;idx++)for(i.push([]),positionType=0;positionType<g_rgPositionNames.length;positionType++)i[idx].push([]),i[idx][positionType]=jQuery.map(a,function(a,e){var i=0;for(positionInfo in a.player_stats[idx+1].position_info.position_details){var r=a.player_stats[idx+1].position_info.position_details[positionInfo];parseInt(r.position_category)==positionType&&(i=parseInt(r.position_count))}return[[parseInt(e)-1,i]]});for(o.push([]),positionType=0;positionType<i[0].length;positionType++)for(o[0].push([]),timeIdx=0;timeIdx<i[0][positionType].length;timeIdx++)o[0][positionType].push([timeIdx,0]);for(idx=0;idx<5;idx++)for(positionType=0;positionType<o[0].length;positionType++)for(timeIdx=0;timeIdx<o[0][positionType].length;timeIdx++)o[0][positionType][timeIdx][1]+=i[idx][positionType][timeIdx][1];for(t.push(SimplifyHeroPositions(o[0])),hero=0;hero<5;hero++)r.push(SimplifyHeroPositions(i[hero]))}function ParseKillData(a,e,i,r,t){var o=0,n=0,l=0;for(var s in a)s>1&&(l=parseFloat(a[s-1].death_time)),parseFloat(a[s].death_time)>45+l&&(n+=Math.round((parseFloat(a[s].death_time)-l)/45)),o++;barWidth=numStatMinutes/(o+n+1),n=0,l=0;for(var s in a){s>1&&(l=parseFloat(a[s-1].death_time)),parseFloat(a[s].death_time)>45+l&&(n+=Math.round((parseFloat(a[s].death_time)-l)/45));var d=barWidth*(parseInt(s)+n),p=parseInt(a[s].killer_id),m=parseInt(a[s].victim_id),g=parseFloat(a[s].death_time)/60;e.push([.5*barWidth+d,0]),e.push([g,-500]),e.push(null);var h=[0,0,0,0,0,0],c=parseFloat(a[s].damage_to_kill);for(var _ in a[s].kill_shares){var f=parseInt(a[s].kill_shares[_].player_id);-1==f||f==p||BIsSameTeam(f,m)||t[PlayerToTeamIdx(f)][PlayerToTeamIdx(m)]++,-1==f||BIsSameTeam(f,m)?h[5]+=c*parseFloat(a[s].kill_shares[_].kill_share_percent):h[PlayerToTeamIdx(f)]=c*parseFloat(a[s].kill_shares[_].kill_share_percent)}for(var _ in h)i[_].push([d,h[_]]);-1!=p&&r[PlayerToTeamIdx(p)][PlayerToTeamIdx(m)]++}return barWidth}var g_rgPlayerColors=["#3375ff","#66ffbf","#bf00bf","#f3f00b","#ff6b00","#fe86c2","#a1b447","#65d9f7","#008321","#a46900","#808080","#e2b4fe","#4b7be0","#2c6224","#9fd0ca","#562423"],g_rgPositionNames=["OTHER","BOTTOM_LANE","MID_LANE","TOP_LANE","RADIANT_JUNGLE","DIRE_JUNGLE","RADIANT_ANCIENTS","DIRE_ANCIENTS","RADIANT_SECRET_SHOP","DIRE_SECRET_SHOP","RIVER","ROSHAN_PIT","RADIANT_BASE","DIRE_BASE","FOUNTAIN"],g_rgSimpleLocationColors=["#ffffff","#e3e30f","#e3970f","#e3530f","#3fBf3f","#BA236A","#2355ff","#444444","#000000"],g_rgDetailLocationColors=["#ffffff","#e3e30f","#e3970f","#e3530f","#3fBf3f","#1f6f1f","#BA236A","#8A134A","#BAFFBA","#FFBABA","#2355ff","#CC88ff","#445444","#544444","#000000"],g_rgSimplePositionNames=["OTHER","BOTTOM_LANE","MID_LANE","TOP_LANE","JUNGLE","ANCIENTS","RIVER","BASE","FOUNTAIN"],g_rgLaneLocationColors=["#7e7e09","#a36d0b","#9b390b","#537220"],g_rgLaneLocationColorsDimmed=[],g_rgLaneLocationLocKeys=["DotaTV_Graph_GoldLocation_Location_BottomLane","DotaTV_Graph_GoldLocation_Location_MidLane","DotaTV_Graph_GoldLocation_Location_TopLane","DotaTV_Graph_GoldLocation_Location_Jungle"];g_rgPositionTranslation=[0,1,2,3,4,4,5,5,5,5,6,6,7,7,8];var g_StatData,g_rgRadiantKillMatrix,radiantAssistMatrix,direKillMatrix,direAssistMatrix,radiantKillShares,radiantTimedKills,radiantStackedKills,direKillShares,direTimedKills,direStackedKills,radiantDamageDone,direDamageDone,radiantCreepFarm,direCreepFarm,opposedCreepFarm,g_rgHeroArray,g_rgHeroIDArray,g_DireBalance,g_RadiantBalance,numStatMinutes,direKillBarWidth,radiantKillBarWidth,radiantKillParticipation,direKillParticipation,direTowerKills,radiantTowerKills,totalTowerKills,direLanePerformance,radLanePerformance,direHeroPositions,direHeroPositionsDetailed,direHeroPositionsSimple,direTeamPositionsSimple,direTeamPositionsDetailed,radiantHeroPositions,radiantHeroPositionsDetailed,radiantHeroPositionsSimple,radiantTeamPositionsSimple,radiantTeamPositionsDetailed,g_rgDireParsedHeroPositions,g_rgRadiantParsedHeroPositions,g_rgParsedHeroPositions,direAvailableLaneGold,radiantAvailableLaneGold,direCreepGold,radiantCreepGold,radiantCreepFarm,direCreepFarm,opposedCreepFarm,CBaseGraph=function(a,e){this.$m_Graph=$("#"+a),this.m_GraphOptions=e};CBaseGraph.prototype={constructor:CBaseGraph,Destroy:function(){this.Hide()},Show:function(){this.$m_Graph.parent().removeClass("Hidden")},Hide:function(){this.$m_Graph.parent().addClass("Hidden")},ModifyOption:function(a,e){this.m_GraphOptions[a].value=e},GetOptions:function(){return this.m_GraphOptions},UpdateTeamLogo:function(a,e){var i=$(".Content");VUtils.Assert(i.length);var r="TeamLogo"+a,t=i.find("."+r);t.length||(t=$("<img>").addClass("TeamLogo").addClass(r),i.append(t)),t.attr("src",e)}};var CTeamBalanceGraph=function(){CBaseGraph.call(this,"TeamBalance",{kills:{display_name:g_Localization.Localize("DotaTV_Graph_GameBalance_Option_Kills"),value:!0},buildings:{display_name:g_Localization.Localize("DotaTV_Graph_GameBalance_Option_Buildings"),value:!0},gold:{display_name:g_Localization.Localize("DotaTV_Graph_GameBalance_Option_Gold"),value:!0},xp:{display_name:g_Localization.Localize("DotaTV_Graph_GameBalance_Option_XP"),value:!0}})};CTeamBalanceGraph.prototype=Object.create(CBaseGraph.prototype),CTeamBalanceGraph.prototype.constructor=CTeamBalanceGraph,CTeamBalanceGraph.prototype.Render=function(a){function e(){function e(e){var i={},o=parseInt(a.match_time)>180?60:1;for(r=0,t=e.length;t>r;r++){var n=parseInt(e[r].time/o);i[n]=void 0!==i[n]?i[n]+1:0,e[r].x=n*o,e[r].y=i[n]}return e}if(l.m_GraphOptions.kills.value){var i=n.getCanvas(),o=i.getContext("2d"),s=10,d=.95*n.height(),p=VUtils.Clamp(parseInt($(window).height()/50),20,48),m=e(a.radiant_kills);for(r=0,t=m.length;t>r;r++)o.drawImage(GetHeroImage(m[r].heroid),n.getAxes().xaxis.p2c(m[r].x),d-p*m[r].y,p,p);var g=e(a.dire_kills);for(r=0,t=g.length;t>r;r++)o.drawImage(GetHeroImage(g[r].heroid),n.getAxes().xaxis.p2c(g[r].x),s+p*g[r].y,p,p)}}rgOverallBalance=[],flMaxDelta=0;for(var i=[],r=0;128>r;++r)i.push(0);if(this.m_GraphOptions.kills.value)for(var r=0,t=a.kills.length;t>r;++r)i[r]+=a.kills[r];if(this.m_GraphOptions.buildings.value)for(var r=0,t=a.buildings.length;t>r;++r)i[r]+=a.buildings[r];if(this.m_GraphOptions.xp.value)for(var r=0,t=a.xp.length;t>r;++r)i[r]+=a.xp[r];if(this.m_GraphOptions.gold.value)for(var r=0,t=a.gold.length;t>r;++r)i[r]+=a.gold[r];for(var r=0,t=i.length;t>r;++r)flMaxDelta=Math.max(flMaxDelta,Math.abs(i[r])),rgOverallBalance.push([r/t*a.match_time,i[r]]);var o=[{label:"Radiant Lead",data:rgOverallBalance,color:"#537220",threshold:{below:0,color:"#b85640"}},{label:"Dire Lead",data:[],color:"#7a2a29"}],n=$.plot(this.$m_Graph,o,{images:{show:!0},lines:{show:!0,fill:!0},xaxis:{show:!0,min:0,max:a.match_time,position:"bottom",tickFormatter:FormatTickAsTime},yaxis:{show:!0,min:-1.4*flMaxDelta,max:1.4*flMaxDelta,labelWidth:36,labelHeight:10,position:"left",position:"right",autoscaleMargin:.02,tickFormatter:FormatTicks},legend:{show:!1,labelBoxBorderColor:"#3A3A3A",position:"nw",margin:20,backgroundColor:"#111312",backgroundOpacity:1},grid:{hoverable:!0,backgroundColor:"#111312",color:"#404040",borderWidth:0}}),l=this;e(),this.$m_Graph.bind("plothover",function(a,i,r){n.draw(),e()})};var CGoldGraph=function(){CBaseGraph.call(this,"Gold",{display_kill_icons:{display_name:g_Localization.Localize("DotaTV_Graph_GraphOption_DisplayKills"),value:!0}})};CGoldGraph.prototype=Object.create(CBaseGraph.prototype),CGoldGraph.prototype.constructor=CGoldGraph,CGoldGraph.prototype.Render=function(a){function e(){function e(e){var t={},o=parseInt(a.match_time)>180?60:1;for(i=0,r=e.length;r>i;i++){var n=parseInt(e[i].time/o);t[n]=void 0!==t[n]?t[n]+1:0,e[i].x=n*o,e[i].y=t[n]}return e}if(n.m_GraphOptions.display_kill_icons.value){var t=o.getCanvas(),l=t.getContext("2d"),s=10,d=.95*o.height(),p=VUtils.Clamp(parseInt($(window).height()/50),20,48),m=e(a.radiant_kills);for(i=0,r=m.length;r>i;i++)l.drawImage(GetHeroImage(m[i].heroid),o.getAxes().xaxis.p2c(m[i].x),d-p*m[i].y,p,p);var g=e(a.dire_kills);for(i=0,r=g.length;r>i;i++)l.drawImage(GetHeroImage(g[i].heroid),o.getAxes().xaxis.p2c(g[i].x),s+p*g[i].y,p,p)}}rgOverallBalance=[],flMaxDelta=0;for(var i=0,r=a.gold.length;r>i;++i)flMaxDelta=Math.max(flMaxDelta,Math.abs(a.gold[i])),rgOverallBalance.push([i/r*a.match_time,a.gold[i]]);var t=[{data:rgOverallBalance,color:"#537220",threshold:{below:0,color:"#b85640"}},{data:[],color:"#7a2a29"}],o=$.plot(this.$m_Graph,t,{images:{show:!0},lines:{show:!0,fill:!0},xaxis:{show:!0,min:0,max:a.match_time,position:"bottom",tickFormatter:FormatTickAsTime},yaxis:{show:!0,min:-1.4*flMaxDelta,max:1.4*flMaxDelta,labelWidth:36,labelHeight:10,position:"left",position:"right",autoscaleMargin:.02,tickFormatter:FormatTicks},legend:{show:!1,labelBoxBorderColor:"#3A3A3A",position:"nw",margin:20,backgroundColor:"#111312",backgroundOpacity:1},grid:{hoverable:!0,backgroundColor:"#111312",color:"#404040",borderWidth:0}}),n=this;e()};var CGoldLocationGraph=function(){CBaseGraph.call(this,"GoldLocation",{})};CGoldLocationGraph.prototype=Object.create(CBaseGraph.prototype),CGoldLocationGraph.prototype.constructor=CGoldLocationGraph,CGoldLocationGraph.prototype.Destroy=function(a){CBaseGraph.prototype.Destroy.apply(this,arguments),this.$m_Graph&&this.$m_Graph.unbind("plothover")},CGoldLocationGraph.prototype.Render=function(a){function e(a){f=a}function i(a,e){for(var i=0,r=g_rgLaneLocationColors.length;r>i;++i)a.getData()[i].color=i==f||0>f?g_rgLaneLocationColors[i]:g_rgLaneLocationColorsDimmed[i]}function r(){0>x||clearTimeout(x)}function t(){r(),u.draw(),x=setTimeout(function(){e(-1)},3e3)}function o(a,e,i){$('<div id="Tooltip">'+i+"</div>").css({position:"absolute",display:"none",top:e+5,left:a+5,border:"1px solid #000",padding:"8px","background-color":"#1e2020"}).addClass("DotaFont").appendTo("body").fadeIn(200)}rgBalance=[[],[],[],[],[],[]],rgNegativeBalance=[[],[],[],[],[],[]];for(var n=[],l=a.gold_location[0].length,s=0;s<a.gold_location[0][0].length;++s){var d=12;rgGoldDeltaWindow=[];for(var p=0,m=a.gold_location[0].length;m>p;++p){var g=a.gold_location[0][p][s][0]-a.gold_location[1][p][s][0];3==s&&(g+=a.gold_location[0][p][4][0],g-=a.gold_location[1][p][4][0]),rgGoldDeltaWindow.push(g),rgGoldDeltaWindow.length>d&&(rgGoldDeltaWindow=rgGoldDeltaWindow.slice(1));var h=0;for(var c in rgGoldDeltaWindow)h+=rgGoldDeltaWindow[c];rgGoldDeltaWindow.length>0&&(h/=rgGoldDeltaWindow.length/l*.016*(1+a.match_time)),rgBalance[s].push([p/m*a.match_time,h])}}var _=0;for(var s in rgBalance)for(var p=0,m=rgBalance[s].length;m>p;++p)Math.abs(rgBalance[s][p][1])>_&&(_=Math.abs(rgBalance[s][p][1]));for(var s in rgBalance)4>s&&n.push({label:g_Localization.Localize(g_rgLaneLocationLocKeys[parseInt(s)]),data:rgBalance[s],lines:{show:!0,fill:.1},stack:!1,color:g_rgLaneLocationColors[parseInt(s)]});var f=-1,u=$.plot(this.$m_Graph,n,{images:{show:!0},xaxis:{show:!0,min:-.1*a.match_time,max:a.match_time,position:"bottom",tickFormatter:FormatTickAsTime},yaxis:{show:!0,min:-1.3*_,max:1.3*_,labelWidth:36,labelHeight:10,position:"left",position:"right",autoscaleMargin:.02,tickFormatter:FormatTicks},legend:{show:!0,labelBoxBorderColor:"#111312",position:"nw",margin:-10,backgroundColor:"#111312",backgroundOpacity:.5},grid:{hoverable:!0,backgroundColor:"#111312",color:"#404040",borderWidth:0},hooks:{draw:[i]}});this.$m_Graph.find(".legendLabel").addClass("DotaFont");var x=-1,I=null;this.$m_Graph.bind("plothover",function(a,i,n){n?(e(n.seriesIndex),t(),I!=n.dataIndex&&(I=n.dataIndex,$("#Tooltip").remove(),o(n.pageX,n.pageY,n.series.label))):(r(),e(-1),u.draw(),$("#Tooltip").remove(),I=null)})};var CXPGraph=function(){CBaseGraph.call(this,"XP",{display_kill_icons:{display_name:g_Localization.Localize("DotaTV_Graph_GraphOption_DisplayKills"),value:!0}})};CXPGraph.prototype=Object.create(CBaseGraph.prototype),CXPGraph.prototype.constructor=CXPGraph,CXPGraph.prototype.Render=function(a){function e(){function e(e){var t={},o=parseInt(a.match_time)>180?60:1;for(i=0,r=e.length;r>i;i++){var n=parseInt(e[i].time/o);t[n]=void 0!==t[n]?t[n]+1:0,e[i].x=n*o,e[i].y=t[n]}return e}if(n.m_GraphOptions.display_kill_icons.value){var t=o.getCanvas(),l=t.getContext("2d"),s=10,d=.95*o.height(),p=VUtils.Clamp(parseInt($(window).height()/50),20,48),m=e(a.radiant_kills);for(i=0,r=m.length;r>i;i++)l.drawImage(GetHeroImage(m[i].heroid),o.getAxes().xaxis.p2c(m[i].x),d-p*m[i].y,p,p);var g=e(a.dire_kills);for(i=0,r=g.length;r>i;i++)l.drawImage(GetHeroImage(g[i].heroid),o.getAxes().xaxis.p2c(g[i].x),s+p*g[i].y,p,p)}}rgOverallBalance=[],flMaxDelta=0;for(var i=0,r=a.xp.length;r>i;++i)flMaxDelta=Math.max(flMaxDelta,Math.abs(a.xp[i])),rgOverallBalance.push([i/r*a.match_time,a.xp[i]]);var t=[{data:rgOverallBalance,color:"#537220",threshold:{below:0,color:"#b85640"}},{data:[],color:"#7a2a29"}],o=$.plot(this.$m_Graph,t,{images:{show:!0},lines:{show:!0,fill:!0},xaxis:{show:!0,min:0,max:a.match_time,position:"bottom",tickFormatter:FormatTickAsTime},yaxis:{show:!0,min:-1.4*flMaxDelta,max:1.4*flMaxDelta,labelWidth:36,labelHeight:10,position:"left",position:"right",autoscaleMargin:.02,tickFormatter:FormatTicks},legend:{show:!1,labelBoxBorderColor:"#3A3A3A",position:"nw",margin:20,backgroundColor:"#111312",backgroundOpacity:1},grid:{hoverable:!0,backgroundColor:"#111312",color:"#404040",borderWidth:0}}),n=this;e()},$(function(){for(nHeroID in g_HeroData)GetHeroImage(nHeroID);for(var a=0,e=g_rgLaneLocationColors.length;e>a;++a)g_rgLaneLocationColorsDimmed[a]=VUtils.LightenOrDarkenColor(g_rgLaneLocationColors[a],-95)});